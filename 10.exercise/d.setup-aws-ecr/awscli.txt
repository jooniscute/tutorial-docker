# Basic AWS CLIs
# https://docs.aws.amazon.com/cli/latest/userguide/welcome-examples.html

sudo apt install awscli

aws --version

aws configure
 - AWS Access Key ID
 - AWS Secret Access Key
 - Default region name


# check output

json, text, table

aws ec2 describe-regions --output text
aws ec2 describe-regions --output table
aws ec2 describe-regions --output json



# iam

aws iam create-group --group-name my-group

aws iam create-user --user-name my-user

aws iam add-user-to-group --user-name my-user --group-name my-group

aws iam get-group --group-name my-group

cat > my-policy.json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "NotAction": "iam:",
            "Resource": "*"
        }
    ]
}

aws iam put-user-policy --user-name my-user --policy-name my-power-user-role -policy-document file://my-policy.json

aws iam list-user-policies --uesr-name my-user

aws iam create-login-profile --user-name my-user --password abcd1234

aws iam create-access-key --user-name my-user


## clean up the created iam user

aws iam delete-access-key XXXXXXXX

aws iam delete-user --user-name my-user

aws iam delete-group --group-name my-group



# ec2
# https://docs.aws.amazon.com/ko_kr/cli/latest/reference/ec2/describe-instances.html

aws ec2 describe-instances

aws ec2 create-key-pair --key-name my-keypair --query 'KeyMaterial' --output text > my-keypair.pem

aws ec2 create-security-group --group-name my-group-sg --description "Security group for my instance"

aws ec2 authorize-security-group-ingress --group-name my-group-sg --protocol tcp --port 22 --cidr 0.0.0.0/0

aws ec2 run-instances --image-id ami-0454bb2fefc7de534 --count 1 --instance-type t2.micro --key-name my-keypair --security-group my-group-sg

aws ec2 describe-instances

aws ec2 describe-instances --query 'Reservations[*].Instances[*].[InstanceId,State.Name,LaunchTime,PublicIpAddress]'

aws ec2 describe-instances --query 'Reservations[*].Instances[*].{Name:Tags[?Key==`Name`]|[0].Value,Id:InstanceId,State:State.Name,Launch:LaunchTime,PublicIP:PublicIpAddress}' --output table

